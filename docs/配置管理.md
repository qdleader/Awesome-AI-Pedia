# 配置管理指南

## 问题说明

每次添加新文件夹时，如果忘记更新配置文件，会导致网站出现 **404错误**。

这是因为项目使用了符号链接系统，需要在多个配置文件中同步更新。

## 快速解决方案

### 1. 检查配置状态

```bash
npm run check-config
```

这会检测所有内容文件夹，并报告哪些文件夹缺少配置。

### 2. 自动修复配置

```bash
npm run fix-config
```

这会自动更新以下配置文件：
- `scripts/copy-symlinks.js` - 添加新文件夹到符号链接映射
- `docs/.vitepress/utils/sidebar.ts` - 添加新文件夹到名称映射

### 3. 重新构建

```bash
npm run build
```

## 完整工作流程

当你想添加新的内容文件夹时：

```bash
# 1. 在根目录创建新文件夹（例如：新文件夹）
mkdir 新文件夹

# 2. 添加内容文件
echo "# 欢迎" > 新文件夹/index.md

# 3. 自动修复配置
npm run fix-config

# 4. 验证配置
npm run check-config

# 5. 本地测试
npm run dev

# 6. 构建并部署
npm run build
git add .
git commit -m "feat: 添加新文件夹"
git push
```

## 配置文件说明

### 1. `scripts/copy-symlinks.js`

在 `symlinkMap` 中配置文件夹映射：

```javascript
const symlinkMap = {
  'url-friendly-name': '实际文件夹名',
  // 例如：
  'bu-shu-ai': '部署ai'
}
```

**作用**: 构建时将根目录的文件夹复制到 `docs/ai/` 下

### 2. `docs/.vitepress/utils/sidebar.ts`

#### `getDisplayName()` - 显示名称映射

```typescript
const nameMap: Record<string, string> = {
  '文件夹名': '显示名称',
  // 例如：
  '部署ai': '部署AI'
}
```

#### `getUrlFriendlyName()` - URL友好名称

```typescript
const urlMap: Record<string, string> = {
  '实际文件夹名': 'url-friendly-name',
  // 例如：
  '部署ai': 'bu-shu-ai'
}
```

**作用**: 生成导航栏和侧边栏的链接

## 常见问题

### Q: 为什么需要配置多个文件？

A: 项目设计采用了符号链接系统来组织内容，这样可以将不同主题的内容放在独立的文件夹中，便于管理。但代价是需要手动维护映射关系。

### Q: 忘记配置会怎样？

A: 新文件夹的内容不会被复制到构建目录，导航栏虽然会显示该文件夹，但点击会出现404错误。

### Q: 如何快速诊断404问题？

A: 运行 `npm run check-config`，它会告诉你哪些文件夹缺少配置。

### Q: 可以手动配置吗？

A: 可以，但推荐使用 `npm run fix-config` 自动配置，避免遗漏和错误。

## 技术细节

### URL命名规则

- 中文目录名会被转换为拼音或英文
- 多个单词用连字符 `-` 连接
- 例如：`部署ai` → `bu-shu-ai`

### 文件夹识别规则

系统会自动识别根目录下的所有文件夹，除了以下排除目录：
- `node_modules`
- `docs`
- `scripts`
- `.git`
- `.github`
- `public`
- `dist`
- `.claude`
- `.vscode`

## 最佳实践

1. **添加新文件夹前**: 先运行 `npm run check-config` 确保当前配置完整
2. **添加新文件夹后**: 立即运行 `npm run fix-config` 更新配置
3. **提交代码前**: 运行 `npm run build` 确保构建成功
4. **推送代码后**: 检查 GitHub Actions 构建状态

## 脚本说明

- `npm run check-config` - 检查配置完整性（不修改文件）
- `npm run fix-config` - 自动修复缺失的配置
- `npm run build` - 完整构建（包含符号链接处理）
